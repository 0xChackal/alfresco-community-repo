<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<!-- This context file inserts the Alfresco SAXParserFactory and DocumentBuilderFactory and specifies how they are configured -->
<beans>

    <!--
    This bean is used to inject overrides for the "javax.xml.parsers.SAXParserFactory" and "javax.xml.parsers.DocumentBuilderFactory"
    JVM options. By default, this injects values that specify custom factory classes that are derived from the standard Xerces 
    factory classes.
     -->
    <bean id="xmlSystemPropertiesConfigurer" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetObject">
            <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
                <property name="targetClass" value="java.lang.System" />
                <property name="targetMethod" value="getProperties" />
            </bean>
        </property>
        <property name="targetMethod" value="putAll" />
        <property name="arguments">
            <props>
                <prop key="javax.xml.parsers.SAXParserFactory">org.alfresco.util.xml.SAXParserFactoryXercesImpl</prop>
                <prop key="javax.xml.parsers.DocumentBuilderFactory">org.alfresco.util.xml.DocumentBuilderFactoryXercesImpl</prop>
            </props>
        </property>
    </bean>

    <!--
    This bean is purely used to initialise static members of the SAXParserFactoryXercesImpl class that specify
    features that are to be enabled and disabled by default. 
     -->
    <bean id="saxParserFactory" class="org.alfresco.util.xml.SAXParserFactoryXercesImpl">
        <property name="featuresToDisable" ref="saxFeaturesToDisable" />
        <property name="featuresToEnable" ref="saxFeaturesToEnable" />
    </bean>

    <!--
    The default list of features that should be disabled by default in any SAX parsers. Be aware that overriding
    this bean and providing a different list may have serious security implications for your system. Do not do so
    unless you are confident that you know what you're doing.
     -->
    <bean id="saxFeaturesToDisable" class="java.util.ArrayList">
        <constructor-arg>
            <list>
                <value>http://xml.org/sax/features/external-general-entities</value>
                <value>http://xml.org/sax/features/external-parameter-entities</value>
                <value>http://xml.org/sax/features/use-entity-resolver2</value> 
            </list>
        </constructor-arg>
    </bean>

    <!--
    The default list of features that should be enabled by default in any SAX parsers. Note that
    any features specified in both this list *and* the "saxFeaturesToDisable" list will be disabled. That is to
    say that the "disable" list wins.
     -->
    <bean id="saxFeaturesToEnable" class="java.util.ArrayList" />

    <!--
    This bean is purely used to initialise static members of the DocumentBuilderFactoryXercesImpl class that specify
    features that are to be enabled and disabled by default. 
     -->
    <bean id="xmlDocumentBuilderFactory" class="org.alfresco.util.xml.DocumentBuilderFactoryXercesImpl">
        <property name="featuresToDisable" ref="docBuilderFeaturesToDisable" />
        <property name="featuresToEnable" ref="docBuilderFeaturesToEnable" />
    </bean>

    <!--
    The default list of features that should be disabled by default in any XML document builders. Be aware that overriding
    this bean and providing a different list may have serious security implications for your system. Do not do so
    unless you are confident that you know what you're doing.
    
    This list simply references the "saxFeaturesToDisable" bean by default.
     -->
    <bean id="docBuilderFeaturesToDisable" class="java.util.ArrayList">
        <constructor-arg ref="saxFeaturesToDisable" />
    </bean>

    <!--
    The default list of features that should be enabled by default in any XML document builders. Note that
    any features specified in both this list *and* the "saxFeaturesToDisable" list will be disabled. That is to
    say that the "disable" list wins.
     -->
    <bean id="docBuilderFeaturesToEnable" class="java.util.ArrayList" >
        <constructor-arg ref="saxFeaturesToEnable" />
    </bean>
</beans>
