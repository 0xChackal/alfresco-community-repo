<?xml version="1.0" encoding="UTF-8"?>

<!-- This describes a process for submitting changed content in a user -->
<!-- sandbox, via an approver, to the staging sandbox. -->

<process-definition xmlns="urn:jbpm.org:jpdl-3.1" name="wcmwf:submit">

    <swimlane name="initiator"/>

    <start-state name="start">
        <task name="wcmwf:startSubmit" swimlane="initiator">
            <controller>
                <!-- <variable name="assignee" access="write" mapped-name="wcmwf:assignee"/> -->
                <!-- <variable name="description" access="write" mapped-name="wcmwf:description"/> -->
                <variable name="package" access="write" mapped-name="bpm:package"/>
                <variable name="workflowcontext" access="write" mapped-name="bpm:context"/>
            </controller>
        </task>
        <transition name="" to="setup"/>
    </start-state>

	<task-node name="setup">
		<task name="wcmwf:setupSubmit" swimlane="initiator">
			<controller>
				<variable name="assignee" access="write" mapped-name="wcmwf:assignee"/>
				<variable name="description" access="write" mapped-name="wcmwf:description"/>
				<variable name="package" access="write" mapped-name="bpm:package"/>
				<variable name="workflowcontext" access="write" mapped-name="bpm:context"/>
			</controller>
		</task>
		<transition name="" to="review"/>
	</task-node>
	
    <swimlane name="assignee">
        <assignment actor-id="#{assignee.properties['cm:userName']}"/>
    </swimlane>

    <task-node name="review">
        <task name="wcmwf:review" swimlane="assignee">
            <controller>
                <variable name="description" access="read,required" mapped-name="wcmwf:description"/>
                <variable name="package" access="read,required" mapped-name="bpm:package"/>
                <variable name="workflowcontext" access="read,required" mapped-name="bpm:context"/>
            </controller>
        </task>
        <transition name="Approve" to="end">
            <action class="org.alfresco.repo.avm.wf.AVMSubmitPackageHandler"/>
        </transition>
    </task-node>

    <end-state name="end"/>

</process-definition>